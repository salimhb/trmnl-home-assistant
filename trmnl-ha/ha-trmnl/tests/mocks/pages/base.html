<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mock Home Assistant</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Roboto, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f1f1f1;
      color: #212121;
    }

    body.dark-mode {
      background: #111111;
      color: #e1e1e1;
    }

    hui-card {
      display: block;
      margin: 16px;
      padding: 24px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    body.dark-mode hui-card {
      background: #1c1c1c;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 24px;
      font-weight: 400;
      margin-bottom: 8px;
    }

    p {
      font-size: 14px;
      line-height: 1.6;
      color: #727272;
    }

    body.dark-mode p {
      color: #9b9b9b;
    }
  </style>
</head>
<body>
  <!--
    Mock Home Assistant DOM structure
    Matches the exact Shadow DOM hierarchy expected by screenshot.js (lines 244-266)
  -->
  <home-assistant>
    <template shadowrootmode="open">
      <home-assistant-main>
        <template shadowrootmode="open">
          <partial-panel-resolver>
            <hui-root>
              <template shadowrootmode="open">
                <hui-view>
                  <template shadowrootmode="open">
                    <hui-card>
                      <h1>üè† Mock Home Assistant</h1>
                      <p>This is the base template page with minimal content.</p>
                      <p style="margin-top: 12px; font-size: 14px;"><strong>Available dashboards:</strong></p>
                      <ul style="margin-top: 8px; line-height: 1.8;">
                        <li><a href="/lovelace/0" style="color: #03a9f4;">/lovelace/0</a> - Test Dashboard (gradients, stats)</li>
                        <li><a href="/lovelace/1" style="color: #03a9f4;">/lovelace/1</a> - Energy Dashboard</li>
                      </ul>
                      <p style="margin-top: 16px; font-size: 12px; color: #666;">
                        üí° This mock provides the Shadow DOM structure for Puppeteer testing without a real HA instance.
                      </p>
                    </hui-card>
                  </template>
                </hui-view>
              </template>
            </hui-root>
          </partial-panel-resolver>
        </template>
      </home-assistant-main>
    </template>
  </home-assistant>

  <script>
    /**
     * Mock Home Assistant client-side API
     * Implements the methods called by screenshot.js during page manipulation
     */
    (function() {
      const haEl = document.querySelector('home-assistant');

      if (!haEl) {
        console.error('[Mock] home-assistant element not found');
        return;
      }

      /**
       * Language switching (called by screenshot.js:376)
       * @param {string} lang - Language code (e.g., 'en', 'es', 'fr')
       * @param {boolean} saveToStorage - Whether to persist (we ignore this in mock)
       */
      /**
       * Mock hass object with connection (mimics home-assistant-js-websocket).
       * UpdateTheme intercepts sendMessage/sendMessagePromise to prevent
       * theme persistence to the user profile (HA 2026.2+ behavior).
       */
      haEl.hass = {
        connection: {
          sendMessage: function(msg) {
            console.log(`[Mock] WS sendMessage: ${JSON.stringify(msg)}`);
          },
          sendMessagePromise: function(msg) {
            console.log(`[Mock] WS sendMessagePromise: ${JSON.stringify(msg)}`);
            return Promise.resolve(null);
          }
        }
      };

      haEl._selectLanguage = function(lang, saveToStorage = true) {
        const language = lang || 'en';
        document.documentElement.lang = language;
        console.log(`[Mock] Language set to: ${language}`);
      };

      /**
       * Theme switching (called via custom event).
       * Listens for 'settheme' event with {theme, dark} detail.
       */
      haEl.addEventListener('settheme', function(e) {
        const { theme, dark } = e.detail || {};

        // Apply dark mode class
        document.body.classList.toggle('dark-mode', dark === true);

        // Set theme attribute
        if (theme) {
          document.body.setAttribute('data-theme', theme);
        }

        console.log(`[Mock] Theme set: ${theme || 'default'}, dark mode: ${dark ? 'on' : 'off'}`);
      });

      // Mark partial-panel-resolver as loaded (screenshot.js checks this at line 256)
      const panelResolver = haEl.shadowRoot
        ?.querySelector('home-assistant-main')
        ?.shadowRoot
        ?.querySelector('partial-panel-resolver');

      if (panelResolver) {
        panelResolver._loading = false;
        console.log('[Mock] Panel resolver marked as loaded');
      }

      console.log('[Mock] Home Assistant client-side API initialized');
    })();
  </script>
</body>
</html>
